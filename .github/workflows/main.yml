name: Story to Video Free
on:
  workflow_dispatch:
    inputs:
      story:
        description: 'اكتب قصتك هنا'
        required: true
        default: 'A majestic dragon flying over mountains'

jobs:
  make-video:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: Install Tools
        run: pip install gradio_client deep-translator

      - name: Generate Video
        run: |
          python - <<EOF
          from gradio_client import Client
          from deep_translator import GoogleTranslator
          import os

          # 1. ترجمة فورية
          arabic_text = "${{ github.event.inputs.story }}"
          translated = GoogleTranslator(source='auto', target='en').translate(arabic_text)
          print(f"Processing: {translated}")

          # 2. محرك فيديو بديل (Mochi-1-Preview) - غالباً يكون متاحاً
          try:
              client = Client("fffiloni/moco-mochi-preview-api") # محرك جديد
              result = client.predict(
                  prompt=translated,
                  negative_prompt="low quality, blurry",
                  num_frames=41,
                  api_name="/generate_video"
              )
              # حفظ الفيديو
              video_path = result if isinstance(result, str) else result[0]
              os.rename(video_path, "final_story.mp4")
              print("SUCCESS: Video generated!")
          except Exception as e:
              print(f"Engine Busy: {e}")
              with open("status.txt", "w") as f: f.write("Servers are busy now, try again later.")
          EOF

      - name: Upload Result
        uses: actions/upload-artifact@v4
        with:
          name: my-story-video
          path: |
            final_story.mp4
            status.txt
