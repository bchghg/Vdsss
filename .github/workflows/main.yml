name: Story to Video Free
on:
  workflow_dispatch:
    inputs:
      story:
        description: 'اكتب قصتك هنا'
        required: true
        default: 'A cat walking in space'

jobs:
  make-video:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: Install Tools
        run: pip install gradio_client deep-translator

      - name: Generate Video
        run: |
          python - <<EOF
          from gradio_client import Client
          from deep_translator import GoogleTranslator
          import os

          arabic_text = "${{ github.event.inputs.story }}"
          translated = GoogleTranslator(source='auto', target='en').translate(arabic_text)
          print(f"Translating to: {translated}")

          try:
              # محرك Luma المتاح عبر Hugging Face كـ Space
              client = Client("jbilcke-hf/Luma-Dream-Machine")
              result = client.predict(
                  prompt=translated,
                  api_name="/predict"
              )
              # إذا كانت النتيجة مسار ملف
              video_path = result if isinstance(result, str) else result[0]
              os.rename(video_path, "final_story.mp4")
              print("Success!")
          except Exception as e:
              print(f"Error: {e}")
              with open("error_log.txt", "w") as f:
                  f.write(f"المحرك مشغول حالياً. الخطأ: {e}")
          EOF

      - name: Save Result
        uses: actions/upload-artifact@v4
        with:
          name: ai-output
          path: |
            final_story.mp4
            error_log.txt
